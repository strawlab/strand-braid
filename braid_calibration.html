<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Braid: 3D Calibration - User's Guide for Braid and Strand Camera</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Low latency image processing and tracking">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="braid-and-strand-camera.html">Braid and Strand Camera</a></li><li class="chapter-item expanded "><a href="hardware-selection.html"><strong aria-hidden="true">1.</strong> Hardware selection</a></li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded "><a href="braid_configuration_and_launching.html"><strong aria-hidden="true">3.</strong> Configuring and Launching Braid</a></li><li class="chapter-item expanded "><a href="braidz-files.html"><strong aria-hidden="true">4.</strong> BRAIDZ files and Analysis Scripts</a></li><li class="chapter-item expanded "><a href="braid_3d_tracking.html"><strong aria-hidden="true">5.</strong> Braid: 3D Tracking</a></li><li class="chapter-item expanded "><a href="parameters_for_object_detection_and_tracking.html"><strong aria-hidden="true">6.</strong> Parameters for Object Detection and Tracking</a></li><li class="chapter-item expanded "><a href="braid_calibration.html" class="active"><strong aria-hidden="true">7.</strong> Braid: 3D Calibration</a></li><li class="chapter-item expanded "><a href="braid_remote_cameras.html"><strong aria-hidden="true">8.</strong> Braid: Remote cameras</a></li><li class="chapter-item expanded "><a href="scripting-with-python.html"><strong aria-hidden="true">9.</strong> Scripting with Python</a></li><li class="chapter-item expanded "><a href="processing-saved-videos.html"><strong aria-hidden="true">10.</strong> Processing saved videos</a></li><li class="chapter-item expanded "><a href="fmf_format.html"><strong aria-hidden="true">11.</strong> Fly Movie Format</a></li><li class="chapter-item expanded "><a href="troubleshooting.html"><strong aria-hidden="true">12.</strong> Troubleshooting</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">User's Guide for Braid and Strand Camera</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        <a href="https://github.com/strawlab/strand-braid/tree/main/strand-braid-user/users-guide" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#calibration-in-braid" id="calibration-in-braid">Calibration in Braid</a></h1>
<h2><a class="header" href="#what-is-a-calibration" id="what-is-a-calibration">What is a calibration?</a></h2>
<p>In our usage here, we refer to a calibration as a model of a camera which allows
us to compute the 2D image location of a given 3D point. Braid can use
calibrations of multiple cameras to calculate the 3D position of a given point
when viewed in 2D camera images.</p>
<p>For a given camera, the calibration is divided into two parts. The &quot;extrinsics&quot;,
or extrinsic parameters, define the pose of the camera. This is the 3D position
and orientation of the camera. The &quot;intrinsics&quot;, or intrinsic parameters, define
the projection of 3D coordinates relative to the camera to an image point in
pixels. In Braid, the camera model is a pinhole model with warping distortion.
The intrinsic parameters include focal length, the pixel coordinates of the
optical axis, and the radial and tangential parameters of a &quot;plumb bob&quot;
distortion model (also called the Brown-Conrady distortion model).</p>
<h2><a class="header" href="#xml-calibration-files-in-braid" id="xml-calibration-files-in-braid">XML calibration files in Braid</a></h2>
<p>The XML calibration files used in Braid are backwards-compatible with those from
Braid's predecessor, Flydra. A braid XML calibration file contains multiple
individual camera calibrations and potentially and &quot;global&quot; information, such as
whether there is an air-water interface for use in the case when cameras are
looking down into water.</p>
<p>While the format of the XML file is specific to Braid, the actual camera
calibration parameters are conventional and could be obtained via other
workflows than that described here. For example, the &quot;traditional&quot; calibration
method from <a href="https://github.com/strawlab/flydra">flydra</a> uses the
<a href="https://github.com/strawlab/MultiCamSelfCal">MultiCamSelfCal (MCSC) library</a>.
There is also the simple <a href="https://strawlab.org/braid-april-cal-webapp/">Braid April Tag Calibration
Tool</a> tool. There is <a href="https://github.com/strawlab/dlt-april-cal/blob/main/tutorial.ipynb">a tutorial
Jupyter
notebook</a>
for a manual approach involving April Tags.</p>
<h2><a class="header" href="#step-0-setup-cameras-zoom-focus-aperture-gain-and-lights" id="step-0-setup-cameras-zoom-focus-aperture-gain-and-lights">Step 0: setup cameras (zoom, focus, aperture, gain) and lights</a></h2>
<p>Setup camera position, zoom, focus (using an object in the tracking volume) and
aperture (slightly stopped down from wide-open). Exposure times and gains are
set in Strand Cam for each camera individually. Note that if you intend to run
at 100 frames per second, exposure times must be less than 10 milliseconds.
These settings (exposure time and gain) are (unfortunately) currently not saved
in any file, and can be set only in the camera settings GUI (in the browser).
The camera keeps these values persistently when it is on, but if it has been
power cycled, these values will be reset.</p>
<p>Try to obtain a luminance distribution which extends across the entire dynamic
range of your sensor (from intensity values 0 to 255) with very little clipping.</p>
<h2><a class="header" href="#step-1-run-checkerboard-calibration-to-get-the-camera-intrinsic-parameters-for-each-camera" id="step-1-run-checkerboard-calibration-to-get-the-camera-intrinsic-parameters-for-each-camera">Step 1: run &quot;Checkerboard Calibration&quot; to get the camera intrinsic parameters for each camera</a></h2>
<p>(There is a script to draw checkerboards as SVG files:
<a href="https://github.com/strawlab/strand-braid/blob/main/strand-braid-user/scripts/draw_checkerboard_svg.py"><code>draw_checkerboard_svg.py</code></a>.)</p>
<p>In Strand Cam, there is a region called &quot;Checkerboard Calibration&quot; which allows
you to calibrate the camera intrinsic parameters. Show a checkerboard to the
camera. You must enter your the checkerboard parameters into the user interface.
For example, a standard 8x8 checkerboard would have 7x7 corners. Try to show the
checkerboard at different distances and angles. Do not forget to show the
checkerboard corners in the corners of the camera field of view. There is a
field which shows the number of checkerboard collected - this should increase as
the system detects checkerboards. When you have gathered a good set of (say, at
least 10) checkerboards, click the &quot;Perform and Save Calibration&quot; button. The
results of this calibration are saved to the directory
<code>$HOME/.config/strand-cam/camera_info</code>.</p>
<p>As an alternative to running this procedure live with Strand Camera, you may
operate on a directory of PNG images and <a href="https://github.com/strawlab/strand-braid/tree/main/strand-cam/strand-cam-offline-checkerboards">the <code>strand-cam-offline-checkerboards</code>
program</a>.</p>
<p>Regardless of whether you create the YAML file containing the camera intrinsic
parameters, the first lines of the YAML file will contain a comment like the following showing the mean reprojection distance.</p>
<pre><code class="language-text"># Mean reprojection distance: 0.49
</code></pre>
<p>The mean reprojection distance is a measure of how well the checkerboard
calibration procedure functioned and shows the mean distance between the images
of the checkerboard corners in the saved images compared to a (re)projection of
the calibration's model of the checkerboard into a synthetic image, and is
measured in units of pixels. The theoretical optimal distance is zero. Typically
one can expect mean reprojection distances of one or two pixels at most.</p>
<p>Repeat this procedure for all cameras before proceeding to the next step.</p>
<h2><a class="header" href="#step-2-place-april-tags-at-known-3d-locations-in-the-scene" id="step-2-place-april-tags-at-known-3d-locations-in-the-scene">Step 2: place April Tags at known 3D locations in the scene</a></h2>
<p>We need to place fiducial markers with known locations in our scene such that
each camera sees several of them. Three markers visible per camera is a
mathematical bare minimum, but more is better. If multiple cameras can see a
single marker, this can be helpful to ensure the calibration of all cameras is
internally consistent.</p>
<p>Store the 3D location of the center of each tag in a <code>markers-3d-coords.csv</code>
file like the following:</p>
<pre><code class="language-csv">id,x,y,z
10,0.265,0.758,0.112
15,-0.520,0.773,0.770
20,-0.241,0.509,0.060
22,-0.501,1.025,1.388
</code></pre>
<p>This is a CSV file giving the April Tag ID number and the X, Y and Z coordinates
of each marker. The coordinate system must be right-handed and the units of each
coordinate are meters.</p>
<h2><a class="header" href="#step-3-record-detections-of-april-tags-from-each-camera" id="step-3-record-detections-of-april-tags-from-each-camera">Step 3: record detections of April Tags from each camera</a></h2>
<p>TODO: write this. Quick hint: use Strand Cam to record an april tag detection
CSV file for each camera.</p>
<h2><a class="header" href="#step-4-estimate-extrinsic-parameters-and-save-braid-xml-calibration-file" id="step-4-estimate-extrinsic-parameters-and-save-braid-xml-calibration-file">Step 4: Estimate extrinsic parameters and save Braid .xml calibration file</a></h2>
<p>TODO: write this. Quick hint: Use <code>braid-april-cal-cli</code> script.</p>
<h3><a class="header" href="#optional-calibration-with-water" id="optional-calibration-with-water">Optional: Calibration with water</a></h3>
<p>As described
<a href="braid_3d_tracking.html#tracking-in-water-with-cameras-out-of-water">here</a>, Braid
can track objects in water. To enable this, place the string
<code>&lt;water&gt;1.333&lt;/water&gt;</code> in the XML camera calibration file.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="parameters_for_object_detection_and_tracking.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="braid_remote_cameras.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="parameters_for_object_detection_and_tracking.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="braid_remote_cameras.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
